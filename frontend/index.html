<!doctype html>
<html lang="en">
  <head>
    <!-- EMERGENCY: Block Vite client before anything else loads -->
    <script>
      // Ultra-early WebSocket and fetch blocking
      (function () {
        if (
          typeof window !== "undefined" &&
          window.location &&
          window.location.hostname !== "localhost" &&
          window.location.hostname !== "127.0.0.1"
        ) {
          // Emergency WebSocket override
          if (window.WebSocket) {
            var OrigWS = window.WebSocket;
            window.WebSocket = function (url, protocols) {
              var urlStr = url ? url.toString() : "";
              if (
                urlStr.includes("vite") ||
                urlStr.includes("hmr") ||
                urlStr.includes("@vite") ||
                urlStr.includes("24f0659a90184252a93b6fc911098462")
              ) {
                console.log("üö® Emergency blocked WebSocket:", urlStr);
                return {
                  close: function () {},
                  send: function () {},
                  addEventListener: function () {},
                  readyState: 3,
                  CLOSED: 3,
                };
              }
              return new OrigWS(url, protocols);
            };
          }

          // Emergency fetch override
          if (window.fetch) {
            var origFetch = window.fetch;
            window.fetch = function () {
              var url = arguments[0];
              var urlStr = url ? url.toString() : "";
              if (
                urlStr.includes("vite") ||
                urlStr.includes("hmr") ||
                urlStr.includes("@vite") ||
                urlStr.includes("24f0659a90184252a93b6fc911098462")
              ) {
                console.log("üö® Emergency blocked fetch:", urlStr);
                return Promise.resolve(
                  new Response("{}", { status: 200, statusText: "OK" }),
                );
              }
              return origFetch.apply(this, arguments);
            };
          }

          console.log("üö® Emergency Vite blocker active");
        }
      })();
    </script>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#22c55e" />
    <title>Zuasoko - Agricultural Platform</title>
    <!-- CRITICAL: Inline Vite neutralizer for immediate execution -->
    <script>
      // Immediate Vite client neutralization - executes before any other code
      (function () {
        if (
          window.location.hostname === "localhost" ||
          window.location.hostname === "127.0.0.1"
        )
          return;

        // Override WebSocket immediately
        var OrigWS = window.WebSocket;
        window.WebSocket = function (url, protocols) {
          var urlStr = url.toString();
          if (
            urlStr.includes("vite") ||
            urlStr.includes("hmr") ||
            urlStr.includes("ws:") ||
            urlStr.includes("3001")
          ) {
            console.log("üö´ Blocked HMR WebSocket:", urlStr);
            return {
              close: function () {},
              send: function () {},
              addEventListener: function () {},
              removeEventListener: function () {},
              readyState: 3,
              CONNECTING: 0,
              OPEN: 1,
              CLOSING: 2,
              CLOSED: 3,
            };
          }
          return new OrigWS(url, protocols);
        };

        // Override fetch immediately
        var origFetch = window.fetch;
        window.fetch = function () {
          var url = arguments[0];
          var urlStr = typeof url === "string" ? url : url.toString();
          if (
            urlStr.includes("vite") ||
            urlStr.includes("hmr") ||
            urlStr.includes("@vite")
          ) {
            console.log("üö´ Blocked HMR fetch:", urlStr);
            return Promise.resolve(
              new Response("{}", {
                status: 200,
                statusText: "OK",
                headers: { "Content-Type": "application/json" },
              }),
            );
          }
          return origFetch.apply(this, arguments);
        };

        // Block HMR globals immediately
        window.__vite_is_modern_browser = true;
        window.__vite_plugin_react_preamble_installed__ = true;
        window.createHotContext = function () {
          return null;
        };
        window.HMRContext = null;

        // Error suppression
        var origError = console.error;
        console.error = function () {
          var msg = Array.prototype.slice.call(arguments).join(" ");
          if (
            msg.includes("vite") ||
            msg.includes("HMR") ||
            msg.includes("@vite") ||
            (msg.includes("Failed to fetch") &&
              (msg.includes("ping") || msg.includes("WebSocket")))
          )
            return;
          return origError.apply(this, arguments);
        };

        console.log("üõ°Ô∏è Critical Vite neutralizer active");
      })();
    </script>
    <!-- Load full Vite neutralizer module -->
    <script type="module" src="/src/vite-neutralizer.js"></script>
    <script>
      // Comprehensive Vite/HMR suppression for production
      (function () {
        var hostname = window.location.hostname;
        var isProduction = hostname !== "localhost" && hostname !== "127.0.0.1";

        if (isProduction) {
          // Completely block Vite client loading
          window.__vite_is_modern_browser = true;
          window.__vite_plugin_react_preamble_installed__ = true;

          // Block module loading for Vite client
          var originalCreateElement = document.createElement;
          document.createElement = function (tagName) {
            var element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === "script") {
              var originalSetAttribute = element.setAttribute;
              element.setAttribute = function (name, value) {
                if (
                  name === "src" &&
                  (value.includes("/@vite/client") ||
                    value.includes("/vite/client"))
                ) {
                  console.log("Blocked Vite client script:", value);
                  return; // Block the script
                }
                return originalSetAttribute.call(this, name, value);
              };
            }
            return element;
          };

          // Block dynamic imports of Vite client
          var originalImport = window.eval(
            'typeof import !== "undefined" ? import : function() { return Promise.reject(new Error("Dynamic import blocked")); }',
          );
          if (typeof originalImport === "function") {
            window.import = function (specifier) {
              if (
                typeof specifier === "string" &&
                (specifier.includes("@vite/client") ||
                  specifier.includes("vite/client"))
              ) {
                console.log("Blocked Vite client import:", specifier);
                return Promise.reject(new Error("Vite client blocked"));
              }
              return originalImport.apply(this, arguments);
            };
          }

          // Override console methods to suppress HMR errors
          var originalError = console.error;
          var originalWarn = console.warn;

          console.error = function () {
            var message = Array.prototype.slice.call(arguments).join(" ");
            if (
              message.includes("vite") ||
              message.includes("HMR") ||
              message.includes("@vite/client") ||
              message.includes("ping") ||
              message.includes("HMR connection suppressed") ||
              message.includes("eval at messageHandler") ||
              message.includes("24f0659a90184252a93b6fc911098462") ||
              message.includes("fly.dev") ||
              (message.includes("Failed to fetch") &&
                (message.includes("WebSocket") || message.includes("ping")))
            ) {
              return; // Suppress HMR-related errors
            }
            originalError.apply(console, arguments);
          };

          console.warn = function () {
            var message = Array.prototype.slice.call(arguments).join(" ");
            if (
              message.includes("vite") ||
              message.includes("HMR") ||
              message.includes("@vite/client") ||
              message.includes("HMR connection suppressed") ||
              message.includes("eval at messageHandler")
            ) {
              return; // Suppress HMR-related warnings
            }
            originalWarn.apply(console, arguments);
          };

          // Disable error reporting for specific patterns
          window.addEventListener(
            "error",
            function (e) {
              if (
                e.message &&
                (e.message.includes("vite") ||
                  e.message.includes("HMR connection suppressed") ||
                  e.message.includes("eval at messageHandler") ||
                  e.message.includes("24f0659a90184252a93b6fc911098462") ||
                  (e.message.includes("Failed to fetch") &&
                    (e.filename.includes("vite") ||
                      e.filename.includes("errorHandler"))))
              ) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
              }
            },
            true,
          );

          // Disable unhandled promise rejection for HMR
          window.addEventListener(
            "unhandledrejection",
            function (e) {
              if (
                e.reason &&
                e.reason.message &&
                (e.reason.message.includes("vite") ||
                  e.reason.message.includes("HMR connection suppressed") ||
                  e.reason.message.includes("eval at messageHandler") ||
                  (e.reason.message.includes("Failed to fetch") &&
                    (e.reason.stack || "").includes("ping")))
              ) {
                e.preventDefault();
                e.stopImmediatePropagation();
                return false;
              }
            },
            true,
          );

          // Block WebSocket connections to Vite HMR
          var OriginalWebSocket = window.WebSocket;
          window.WebSocket = function (url, protocols) {
            var urlString = url.toString();
            if (
              urlString.includes("vite") ||
              urlString.includes("hmr") ||
              urlString.includes("3001") ||
              urlString.match(/ws.*localhost/)
            ) {
              console.log("Blocked Vite WebSocket connection:", urlString);
              // Return a fake WebSocket that does nothing
              return {
                close: function () {},
                send: function () {},
                addEventListener: function () {},
                removeEventListener: function () {},
                readyState: 3, // CLOSED
                CONNECTING: 0,
                OPEN: 1,
                CLOSING: 2,
                CLOSED: 3,
              };
            }
            return new OriginalWebSocket(url, protocols);
          };

          // Copy static properties
          Object.setPrototypeOf(window.WebSocket, OriginalWebSocket);
          window.WebSocket.prototype = OriginalWebSocket.prototype;
          window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
          window.WebSocket.OPEN = OriginalWebSocket.OPEN;
          window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
          window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;

          // Block HMRContext and related functions completely
          window.HMRContext = undefined;
          window.createHotContext = function () {
            return {};
          };

          // Override any attempts to access these in modules
          Object.defineProperty(window, "HMRContext", {
            get: function () {
              return undefined;
            },
            set: function () {
              /* do nothing */
            },
            configurable: false,
          });

          // Block module loading that might contain HMR code
          var originalDefine = window.define;
          if (typeof originalDefine === "function") {
            window.define = function (id, deps, factory) {
              if (
                typeof id === "string" &&
                (id.includes("vite") || id.includes("hmr"))
              ) {
                console.log("Blocked AMD module with Vite/HMR:", id);
                return;
              }
              return originalDefine.apply(this, arguments);
            };
          }

          // Block eval execution of HMR-related code
          var originalEval = window.eval;
          window.eval = function (code) {
            if (
              typeof code === "string" &&
              (code.includes("HMRContext") ||
                code.includes("createHotContext") ||
                code.includes("@vite/client") ||
                code.includes("vite/dist/client"))
            ) {
              console.log("Blocked eval execution of HMR code");
              return;
            }
            return originalEval.call(this, code);
          };

          // Block Function constructor for HMR code
          var OriginalFunction = window.Function;
          window.Function = function () {
            var code = Array.prototype.slice.call(arguments, -1)[0];
            if (
              typeof code === "string" &&
              (code.includes("HMRContext") ||
                code.includes("createHotContext") ||
                code.includes("@vite/client"))
            ) {
              console.log("Blocked Function constructor with HMR code");
              return function () {};
            }
            return OriginalFunction.apply(this, arguments);
          };

          // Set prototype to maintain instanceof checks
          window.Function.prototype = OriginalFunction.prototype;
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
