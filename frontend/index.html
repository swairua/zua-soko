<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#22c55e" />
    <title>Zuasoko - Agricultural Platform</title>
    <script>
      // Comprehensive Vite/HMR suppression for production
      (function () {
        var hostname = window.location.hostname;
        var isProduction = hostname !== "localhost" && hostname !== "127.0.0.1";

        if (isProduction) {
          // Completely block Vite client loading
          window.__vite_is_modern_browser = true;
          window.__vite_plugin_react_preamble_installed__ = true;

          // Block module loading for Vite client
          var originalCreateElement = document.createElement;
          document.createElement = function (tagName) {
            var element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === "script") {
              var originalSetAttribute = element.setAttribute;
              element.setAttribute = function (name, value) {
                if (
                  name === "src" &&
                  (value.includes("/@vite/client") ||
                    value.includes("/vite/client"))
                ) {
                  console.log("Blocked Vite client script:", value);
                  return; // Block the script
                }
                return originalSetAttribute.call(this, name, value);
              };
            }
            return element;
          };

          // Block dynamic imports of Vite client
          var originalImport = window.eval(
            'typeof import !== "undefined" ? import : function() { return Promise.reject(new Error("Dynamic import blocked")); }',
          );
          if (typeof originalImport === "function") {
            window.import = function (specifier) {
              if (
                typeof specifier === "string" &&
                (specifier.includes("@vite/client") ||
                  specifier.includes("vite/client"))
              ) {
                console.log("Blocked Vite client import:", specifier);
                return Promise.reject(new Error("Vite client blocked"));
              }
              return originalImport.apply(this, arguments);
            };
          }

          // Override console methods to suppress HMR errors
          var originalError = console.error;
          var originalWarn = console.warn;

          console.error = function () {
            var message = Array.prototype.slice.call(arguments).join(" ");
            if (
              message.includes("vite") ||
              message.includes("HMR") ||
              message.includes("@vite/client") ||
              message.includes("ping") ||
              message.includes("HMR connection suppressed") ||
              message.includes("eval at messageHandler") ||
              message.includes("24f0659a90184252a93b6fc911098462") ||
              message.includes("fly.dev") ||
              (message.includes("Failed to fetch") &&
                (message.includes("WebSocket") || message.includes("ping")))
            ) {
              return; // Suppress HMR-related errors
            }
            originalError.apply(console, arguments);
          };

          console.warn = function () {
            var message = Array.prototype.slice.call(arguments).join(" ");
            if (
              message.includes("vite") ||
              message.includes("HMR") ||
              message.includes("@vite/client") ||
              message.includes("HMR connection suppressed") ||
              message.includes("eval at messageHandler")
            ) {
              return; // Suppress HMR-related warnings
            }
            originalWarn.apply(console, arguments);
          };

          // Disable error reporting for specific patterns
          window.addEventListener(
            "error",
            function (e) {
              if (
                e.message &&
                (e.message.includes("vite") ||
                  e.message.includes("HMR connection suppressed") ||
                  e.message.includes("eval at messageHandler") ||
                  e.message.includes("24f0659a90184252a93b6fc911098462") ||
                  (e.message.includes("Failed to fetch") &&
                    (e.filename.includes("vite") ||
                      e.filename.includes("errorHandler"))))
              ) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return false;
              }
            },
            true,
          );

          // Disable unhandled promise rejection for HMR
          window.addEventListener(
            "unhandledrejection",
            function (e) {
              if (
                e.reason &&
                e.reason.message &&
                (e.reason.message.includes("vite") ||
                  e.reason.message.includes("HMR connection suppressed") ||
                  e.reason.message.includes("eval at messageHandler") ||
                  (e.reason.message.includes("Failed to fetch") &&
                    (e.reason.stack || "").includes("ping")))
              ) {
                e.preventDefault();
                e.stopImmediatePropagation();
                return false;
              }
            },
            true,
          );

          // Block WebSocket connections to Vite HMR
          var OriginalWebSocket = window.WebSocket;
          window.WebSocket = function (url, protocols) {
            var urlString = url.toString();
            if (
              urlString.includes("vite") ||
              urlString.includes("hmr") ||
              urlString.includes("3001") ||
              urlString.match(/ws.*localhost/)
            ) {
              console.log("Blocked Vite WebSocket connection:", urlString);
              // Return a fake WebSocket that does nothing
              return {
                close: function () {},
                send: function () {},
                addEventListener: function () {},
                removeEventListener: function () {},
                readyState: 3, // CLOSED
                CONNECTING: 0,
                OPEN: 1,
                CLOSING: 2,
                CLOSED: 3,
              };
            }
            return new OriginalWebSocket(url, protocols);
          };

          // Copy static properties
          Object.setPrototypeOf(window.WebSocket, OriginalWebSocket);
          window.WebSocket.prototype = OriginalWebSocket.prototype;
          window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
          window.WebSocket.OPEN = OriginalWebSocket.OPEN;
          window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
          window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
