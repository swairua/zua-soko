<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#22c55e" />
    <title>Zuasoko - Agricultural Platform</title>
    <!-- CRITICAL: Immediate Vite neutralization -->
    <script>
      (function () {
        // Override WebSocket to prevent HMR connections
        var OrigWS = window.WebSocket;
        window.WebSocket = function (url, protocols) {
          var urlStr = url.toString();
          if (
            urlStr.includes("vite") ||
            urlStr.includes("hmr") ||
            urlStr.includes("ws:") ||
            urlStr.includes("3001")
          ) {
            console.log("üö´ Blocked HMR WebSocket:", urlStr);
            return {
              close: function () {},
              send: function () {},
              addEventListener: function () {},
              removeEventListener: function () {},
              readyState: 3,
              CONNECTING: 0,
              OPEN: 1,
              CLOSING: 2,
              CLOSED: 3,
            };
          }
          return new OrigWS(url, protocols);
        };

        // Override fetch to prevent HMR requests
        var origFetch = window.fetch;
        window.fetch = function () {
          var url = arguments[0];
          var urlStr = typeof url === "string" ? url : url.toString();
          if (
            urlStr.includes("vite") ||
            urlStr.includes("hmr") ||
            urlStr.includes("@vite")
          ) {
            console.log("üö´ Blocked HMR fetch:", urlStr);
            return Promise.resolve(
              new Response("{}", {
                status: 200,
                statusText: "OK",
                headers: { "Content-Type": "application/json" },
              }),
            );
          }
          return origFetch.apply(this, arguments);
        };

        // Neutralize HMR globals
        window.__vite_is_modern_browser = true;
        window.__vite_plugin_react_preamble_installed__ = true;
        window.createHotContext = function () {
          return null;
        };
        window.HMRContext = null;

        // Suppress HMR errors
        var origError = console.error;
        console.error = function () {
          var msg = Array.prototype.slice.call(arguments).join(" ");
          if (
            msg.includes("vite") ||
            msg.includes("HMR") ||
            msg.includes("@vite") ||
            (msg.includes("Failed to fetch") &&
              (msg.includes("ping") || msg.includes("WebSocket")))
          )
            return;
          return origError.apply(this, arguments);
        };

        console.log("üõ°Ô∏è Production Vite neutralizer active");
      })();
    </script>
    <script>
      // Completely block any Vite client or HMR code from loading
      (function () {
        // Block all Vite-related globals
        window.__vite_is_modern_browser = true;
        window.__vite_plugin_react_preamble_installed__ = true;
        window.HMRContext = undefined;
        window.createHotContext = () => undefined;

        // Override import.meta completely
        try {
          Object.defineProperty(window, "import", {
            value: {
              meta: {
                hot: undefined,
                env: { DEV: false, PROD: true },
              },
            },
            configurable: false,
            writable: false,
          });
        } catch (e) {}

        // Block all dynamic imports of Vite modules
        var originalImport = window.eval(
          'typeof import !== "undefined" ? import : null',
        );
        if (originalImport) {
          window.import = function (spec) {
            if (
              typeof spec === "string" &&
              (spec.includes("@vite") ||
                spec.includes("vite/") ||
                spec.includes("hmr"))
            ) {
              return Promise.reject(new Error("Vite modules blocked"));
            }
            return originalImport.apply(this, arguments);
          };
        }

        // Block script tag creation for Vite modules
        var origCreateElement = document.createElement;
        document.createElement = function (tag) {
          var element = origCreateElement.call(document, tag);
          if (tag.toLowerCase() === "script") {
            var origSetAttribute = element.setAttribute;
            element.setAttribute = function (name, value) {
              if (
                name === "src" &&
                value &&
                (value.includes("@vite") ||
                  value.includes("vite/") ||
                  value.includes("hmr"))
              ) {
                console.log("Blocked Vite script:", value);
                return;
              }
              return origSetAttribute.call(this, name, value);
            };
          }
          return element;
        };

        // Block WebSocket connections to dev server
        var OrigWS = window.WebSocket;
        window.WebSocket = function (url, protocols) {
          if (
            url.toString().includes("vite") ||
            url.toString().includes("hmr") ||
            url.toString().includes("3001")
          ) {
            return {
              close: function () {},
              send: function () {},
              addEventListener: function () {},
              readyState: 3,
            };
          }
          return new OrigWS(url, protocols);
        };

        // Block eval and Function for HMR code
        var origEval = window.eval;
        window.eval = function (code) {
          if (
            typeof code === "string" &&
            (code.includes("HMRContext") || code.includes("@vite"))
          ) {
            return;
          }
          return origEval.call(this, code);
        };

        // Suppress all HMR-related errors
        window.addEventListener(
          "error",
          function (e) {
            if (
              e.message &&
              (e.message.includes("HMRContext") ||
                e.message.includes("@vite") ||
                e.message.includes("vite/"))
            ) {
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
          },
          true,
        );

        window.addEventListener(
          "unhandledrejection",
          function (e) {
            if (
              e.reason &&
              e.reason.message &&
              (e.reason.message.includes("HMRContext") ||
                e.reason.message.includes("@vite"))
            ) {
              e.preventDefault();
              return false;
            }
          },
          true,
        );
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
